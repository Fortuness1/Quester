<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../public/css/login.css" />
    <title>Login</title>
  </head>
  <body>
    <div class="main-container">
      <header>
        <nav>
          <ul>
            <li>
              <a href="#"><img src="../public/img/blackLogo.svg" alt="" /></a>
            </li>
            <li>
              <a href="#">
                <img src="../public/img/interrogacao.svg" alt="" />
              </a>
            </li>
          </ul>
        </nav>
      </header>
      <main>
        <div class="container-mascot container-settings">
          <div class="image-mascot"></div>
          <div class="points">
            <div class="point"></div>
            <div class="point"></div>
            <div class="point"></div>
          </div>
        </div>
        <div class="login-container container-settings">
          <div class="login-box">
            <form id="loginForm">
              <h2>Login</h2>
              <div class="input-box">
                <input
                  type="text"
                  id="email"
                  class="email"
                  name="email"
                  placeholder="E-mail"
                  required
                />
                <i class="material-icons">mail</i>
              </div>

              <div class="input-box">
                <input
                  type="password"
                  id="password"
                  name="password"
                  placeholder="Senha"
                  required
                />
                <i class="material-icons">lock</i>
              </div>
              <div id="login-error" class="mensagem-erro"></div>

              <button type="submit">Entrar</button>
            </form>

            <div class="register-link">
              <p>Não tem conta? <a href="register.html">Cadastre-se</a></p>
            </div>
          </div>
        </div>
      </main>
    </div>

    <script>
      document
        .getElementById("loginForm")
        .addEventListener("submit", async (event) => {
          event.preventDefault();

          const emailInput = document.getElementById("email");
          const passwordInput = document.getElementById("password");
          const errorDiv = document.getElementById("login-error");

          const email = emailInput.value;
          const password = passwordInput.value;

          try {
            const response = await fetch("http://localhost:3000/login", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ email, password }),
            });

            const data = await response.json();

            if (response.ok) {
              document.body.classList.add("fade"); 
              setTimeout(() => {
                if (email.endsWith("@virtual.ufc.br")) {
                  window.location.href = "profHome.html"; 
                } else if (email.endsWith("@alu.ufc.br")) {
                  window.location.href = "alunoHome.html";
                } else {
                  errorDiv.textContent = "E-mail inválido.";
                  errorDiv.style.color = "red";
                }
              }, 500);
            } else {
              errorDiv.textContent = "E-mail ou senha incorretos.";
              errorDiv.style.color = "red";
            }
          } catch (error) {
            console.error("Erro na requisição:", error);
            errorDiv.textContent = "Erro na requisição.";
            errorDiv.style.color = "red";
          }
        });
    </script>
  </body>
</html>
